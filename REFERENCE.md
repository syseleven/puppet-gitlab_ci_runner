# Reference

<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

### Classes

#### Public Classes

* [`gitlab_ci_runner`](#gitlab_ci_runner): This module installs and configures Gitlab CI Runners.

#### Private Classes

* `gitlab_ci_runner::config`: Manages the configuration of Gitlab runner
* `gitlab_ci_runner::install`: Manages the package of Gitlab runner
* `gitlab_ci_runner::repo`: Manages the repository for Gitlab runner
* `gitlab_ci_runner::service`: Manages the service of Gitlab runner

### Defined types

* [`gitlab_ci_runner::runner`](#gitlab_ci_runnerrunner): This configures a Gitlab CI runner.

### Data types

* [`Gitlab_ci_runner::Log_format`](#gitlab_ci_runnerlog_format): Gitlab Runner log format configuration
* [`Gitlab_ci_runner::Log_level`](#gitlab_ci_runnerlog_level): Gitlab Runner log level configuration

### Tasks

* [`register_runner`](#register_runner): Registers a runner on a Gitlab instance.
* [`unregister_runner`](#unregister_runner): Unregisters a runner from a Gitlab instance.

## Classes

### <a name="gitlab_ci_runner"></a>`gitlab_ci_runner`

This module installs and configures Gitlab CI Runners.

#### Examples

##### Simple runner registration

```puppet
class { 'gitlab_ci_runner':
  runners => {
 	 example_runner => {
 		 'registration-token' => 'gitlab-token',
 		 'url'                => 'https://gitlab.com',
 		 'tag-list'           => 'docker,aws',
 	 },
  },
}
```

#### Parameters

The following parameters are available in the `gitlab_ci_runner` class:

* [`runners`](#runners)
* [`runner_defaults`](#runner_defaults)
* [`xz_package_name`](#xz_package_name)
* [`concurrent`](#concurrent)
* [`log_level`](#log_level)
* [`log_format`](#log_format)
* [`check_interval`](#check_interval)
* [`sentry_dsn`](#sentry_dsn)
* [`listen_address`](#listen_address)
* [`manage_docker`](#manage_docker)
* [`manage_repo`](#manage_repo)
* [`package_ensure`](#package_ensure)
* [`package_name`](#package_name)
* [`repo_base_url`](#repo_base_url)
* [`repo_keyserver`](#repo_keyserver)
* [`config_path`](#config_path)

##### <a name="runners"></a>`runners`

Data type: `Hash`

Hashkeys are used as $title in runners.pp. The subkeys have to be named as the parameter names from ´gitlab-runner register´ command cause they're later joined to one entire string using 2 hyphen to look like shell command parameters. See ´https://docs.gitlab.com/runner/register/#one-line-registration-command´ for details.

Default value: `{}`

##### <a name="runner_defaults"></a>`runner_defaults`

Data type: `Hash`

A hash with defaults which will be later merged with $runners.

Default value: `{}`

##### <a name="xz_package_name"></a>`xz_package_name`

Data type: `String`

The name of the 'xz' package. Needed for local docker installations.

##### <a name="concurrent"></a>`concurrent`

Data type: `Optional[Integer]`

Limits how many jobs globally can be run concurrently. The most upper limit of jobs using all defined runners. 0 does not mean unlimited!

Default value: ``undef``

##### <a name="log_level"></a>`log_level`

Data type: `Optional[Gitlab_ci_runner::Log_level]`

Log level (options: debug, info, warn, error, fatal, panic). Note that this setting has lower priority than level set by command line argument --debug, -l or --log-level

Default value: ``undef``

##### <a name="log_format"></a>`log_format`

Data type: `Optional[Gitlab_ci_runner::Log_format]`

Log format (options: runner, text, json). Note that this setting has lower priority than format set by command line argument --log-format

Default value: ``undef``

##### <a name="check_interval"></a>`check_interval`

Data type: `Optional[Integer]`

defines the interval length, in seconds, between new jobs check. The default value is 3; if set to 0 or lower, the default value will be used.

Default value: ``undef``

##### <a name="sentry_dsn"></a>`sentry_dsn`

Data type: `Optional[String]`

Enable tracking of all system level errors to sentry.

Default value: ``undef``

##### <a name="listen_address"></a>`listen_address`

Data type: `Optional[Pattern[/.*:.+/]]`

Address (<host>:<port>) on which the Prometheus metrics HTTP server should be listening.

Default value: ``undef``

##### <a name="manage_docker"></a>`manage_docker`

Data type: `Boolean`

If docker should be installs (uses the puppetlabs-docker).

Default value: ``false``

##### <a name="manage_repo"></a>`manage_repo`

Data type: `Boolean`

If the repository should be managed.

Default value: ``true``

##### <a name="package_ensure"></a>`package_ensure`

Data type: `String`

The package 'ensure' state.

Default value: `installed`

##### <a name="package_name"></a>`package_name`

Data type: `String`

The name of the package.

Default value: `'gitlab-runner'`

##### <a name="repo_base_url"></a>`repo_base_url`

Data type: `Stdlib::HTTPUrl`

The base repository url.

Default value: `'https://packages.gitlab.com'`

##### <a name="repo_keyserver"></a>`repo_keyserver`

Data type: `Optional[Stdlib::Fqdn]`

The keyserver which should be used to get the repository key.

Default value: ``undef``

##### <a name="config_path"></a>`config_path`

Data type: `String`

The path to the config file of Gitlab runner.

Default value: `'/etc/gitlab-runner/config.toml'`

## Defined types

### <a name="gitlab_ci_runnerrunner"></a>`gitlab_ci_runner::runner`

This configures a Gitlab CI runner.

#### Examples

##### Add a simple runner

```puppet
gitlab_ci_runner::runner { 'testrunner':
  config               => {
    'url'              => 'https://gitlab.com',
    'token'            => '123456789abcdefgh', # Note this is different from the registration token used by `gitlab-runner register`
    'executor'         => 'shell',
  },
}
```

##### Add a autoscaling runner with DigitalOcean as IaaS

```puppet
gitlab_ci_runner::runner { 'autoscale-runner':
  config => {
    url      => 'https://gitlab.com',
    token    => 'RUNNER_TOKEN', # Note this is different from the registration token used by `gitlab-runner register`
    name     => 'autoscale-runner',
    executor => 'docker+machine',
    limit    => 10,
    docker   => {
      image => 'ruby:2.6',
    },
    machine  => {
      OffPeakPeriods   => [
        '* * 0-9,18-23 * * mon-fri *',
        '* * * * * sat,sun *',
      ],
      OffPeakIdleCount => 1,
      OffPeakIdleTime  => 1200,
      IdleCount        => 5,
      IdleTime         => 600,
      MaxBuilds        => 100,
      MachineName      => 'auto-scale-%s',
      MachineDriver    => 'digitalocean',
      MachineOptions   => [
        'digitalocean-image=coreos-stable',
        'digitalocean-ssh-user=core',
        'digitalocean-access-token=DO_ACCESS_TOKEN',
        'digitalocean-region=nyc2',
        'digitalocean-size=4gb',
        'digitalocean-private-networking',
        'engine-registry-mirror=http://10.11.12.13:12345',
      ],
    },
    cache    => {
      'Type' => 's3',
      s3     => {
        ServerAddress => 's3-eu-west-1.amazonaws.com',
        AccessKey     => 'AMAZON_S3_ACCESS_KEY',
        SecretKey     => 'AMAZON_S3_SECRET_KEY',
        BucketName    => 'runner',
        Insecure      => false,
      },
    },
  },
}
```

#### Parameters

The following parameters are available in the `gitlab_ci_runner::runner` defined type:

* [`config`](#config)

##### <a name="config"></a>`config`

Data type: `Hash`

Hash with configuration options.
See https://docs.gitlab.com/runner/configuration/advanced-configuration.html for all possible options.
If you omit the 'name' configuration, we will automatically use the $title of this define class.

## Data types

### <a name="gitlab_ci_runnerlog_format"></a>`Gitlab_ci_runner::Log_format`

Gitlab Runner log format configuration

Alias of

```puppet
Enum['runner', 'text', 'json']
```

### <a name="gitlab_ci_runnerlog_level"></a>`Gitlab_ci_runner::Log_level`

Gitlab Runner log level configuration

Alias of

```puppet
Enum['debug', 'info', 'warn', 'error', 'fatal', 'panic']
```

## Tasks

### <a name="register_runner"></a>`register_runner`

Registers a runner on a Gitlab instance.

**Supports noop?** false

#### Parameters

##### `url`

Data type: `String[1]`

The url to your Gitlab instance. Please only provide the host part (e.g https://gitlab.com)

##### `token`

Data type: `String[1]`

Registration token.

##### `description`

Data type: `Optional[String[1]]`

Runners description.

##### `info`

Data type: `Optional[Hash]`

Runners metadata.

##### `active`

Data type: `Optional[Boolean]`

Whether the Runner is active.

##### `locked`

Data type: `Optional[Boolean]`

Whether the Runner should be locked for current project.

##### `run_untagged`

Data type: `Optional[Boolean]`

Whether the Runner should handle untagged jobs.

##### `tag_list`

Data type: `Optional[Array[String[1]]]`

List of Runners tags.

##### `access_level`

Data type: `Optional[Enum['not_protected', 'ref_protected']]`

The access_level of the runner.

##### `maximum_timeout`

Data type: `Optional[Integer[1]]`

Maximum timeout set when this Runner will handle the job.

### <a name="unregister_runner"></a>`unregister_runner`

Unregisters a runner from a Gitlab instance.

**Supports noop?** false

#### Parameters

##### `url`

Data type: `String[1]`

The url to your Gitlab instance. Please provide the host part only! (e.g https://gitlab.com)

##### `token`

Data type: `String[1]`

Runners authentication token.

